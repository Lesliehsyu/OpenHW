---
layout: post
title:  "经典游戏：躲避车"
author: XUP-2020
categories: [ project, 2020competition ]
image: assets/images/summer2020_28/cover.png
---

![isolution]({{ site.baseurl }}/assets/images/all_white.jpg)



# **<big>经典游戏：躲避车</big>**

**By&nbsp;洪嘉祥、林云韬**

&nbsp;

## **第一部分**

### 设计概述 /Design Introduction

&nbsp;

经典之所以为经典，就是因为他永远不会过时。我们的日常生活中并不一定有那么多新颖的发现和发明，有时候复现经典也是很好的选择。我们小组决定做一个经典游戏复现，相信游戏&ldquo;躲避车&rdquo;是很多人的童年回忆。我们基于现有的知识水平基础上争取实现&ldquo;躲避车&rdquo;功能的小项目，复现经典。

通过SEA上两个key按键控制进行车辆的显示区域变更，达到左右位置变化的效果，由此躲避障碍物。通过伪随机数序列和计数变量来生成障碍物的纵坐标位置，并使其显示区域不断往左移动直到车的左边后消失，达到我们所控制的车在往右行驶的感觉。最后通过判断车与障碍物的位置来判定是否发生碰撞，发生碰撞即结束游戏，再按一次key即可重新开始游戏。其中还利用了一些标志变量。通过图片和软件来生成coe文件，使用rom,来调用，车与障碍物通过miniHDMI接口来外接显示屏进行显示。

&nbsp;

![image_1]({{ site.baseurl }}/assets/images/summer2020_28/image_1.png)

&nbsp;
## **第二部分**

### 系统组成及功能说明 /System Construction &amp; Function Description

&nbsp;

#### **1：图片的显示**

显示屏显示中需要根据VGA显示逻辑来编写。系统中首先使用了VGA驱动，处理行同步信号HSYNC和场同步信号VSYNC，以及RGB三组颜色控制信号。确定显示参数，分辨率以及刷新率，编写一个时钟来管理扫描的速度。当扫描的帧率不小于30fps时就不会有太明显的卡顿。

![image_2]({{ site.baseurl }}/assets/images/summer2020_28/image_2.png)

通过输出VGA模块的RGB信号将其输入至HDMI驱动转换模块将其转化为HDMI输出信号，HDMI驱动部分与VGA相似，我们需要将产生RGB888三路数据，输入给该模块，然后经过解码、串/并转换，差分输出。输入两个时钟输入，一个是当前显示分辨率的像素时钟，一个是当前显示分辨率的像素时钟的五倍，在这里我们选用的是1920*1080*60HZ的分辨率，所以我们选用的像素时钟分辨率为148.5MHz。产生VGA信号之后，行同步信号与场同步信号将RGB888的数据输入给HDMI 实现HDMI显示屏的显示。

![image_3]({{ site.baseurl }}/assets/images/summer2020_28/image_3.png)

图片的显示是基于此基础上讲图片存入FPGA的ram中再通过读取ram中图片的RGB信号即可。由于一开始试验发现ram并不算大，为了保险起见我们直接使用了黑白图片存入ram，大大节省了空间。

#### **2：图片的移动**

我们添加了小车和路障两种图片。对于小车我们要求其根据按键运动。于是我们编写了按键的检测程序，使得按下版面上两个key键的时候车辆能根据我们锁定的列位置、确定好的行位置而移动。而对于障碍物，我们编写了伪随机数来使其能在跑完一个单程的时间之后选择无法预知的下一赛道，同时利用计时器使其能以我们想要的速度来进行运动。当刷新率够高时，帧数较高则对肉眼来说物体是连续运动的。

#### **3.图片的碰撞**

进行图片区域的设定，判断当图片区域有交集的时候即为碰撞。碰撞之后设立定值，并使得当小车继续移动的时候整个程序也能继续进行。
